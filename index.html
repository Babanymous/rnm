<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rick and Morty Multiverse Map</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Courier New', Courier, monospace; }
        #canvas-container { width: 100vw; height: 100vh; display: block; }
        
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #97ce4c;
            pointer-events: none;
            text-shadow: 0 0 10px #97ce4c;
        }
        h1 { margin: 0; font-size: 24px; text-transform: uppercase; }
        p { margin: 5px 0; font-size: 14px; opacity: 0.8; }

        #info-modal {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background: rgba(0, 20, 0, 0.9);
            border: 2px solid #97ce4c;
            padding: 20px;
            color: #fff;
            display: none;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(151, 206, 76, 0.4);
        }
        #info-modal h2 { margin-top: 0; color: #97ce4c; }
        .data-row { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid #333; padding-bottom: 4px; }
        .label { color: #aaa; font-size: 12px; }
        .value { font-weight: bold; }
        
        #loading {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #97ce4c;
            font-size: 20px;
            animation: pulse 1s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="ui-layer">
        <h1>Multiverse C-137</h1>
        <p>System: Central Finite Curve</p>
        <p>Instructions: Drag to rotate, Scroll to zoom, Click a planet.</p>
    </div>

    <div id="loading">calibrating portal fluid...</div>

    <div id="info-modal">
        <h2 id="loc-name">Location Name</h2>
        <div class="data-row"><span class="label">Type:</span> <span class="value" id="loc-type">Planet</span></div>
        <div class="data-row"><span class="label">Dimension:</span> <span class="value" id="loc-dim">Unknown</span></div>
        <div class="data-row"><span class="label">Residents:</span> <span class="value" id="loc-residents">0</span></div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.002);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 50;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0x97ce4c, 2, 100);
        pointLight.position.set(0, 0, 0);
        scene.add(pointLight);

        const starGeometry = new THREE.BufferGeometry();
        const starCount = 2000;
        const starPos = new Float32Array(starCount * 3);
        for(let i=0; i<starCount*3; i++) {
            starPos[i] = (Math.random() - 0.5) * 400;
        }
        starGeometry.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.5 });
        const stars = new THREE.Points(starGeometry, starMaterial);
        scene.add(stars);

        const planetMeshes = [];
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        async function fetchUniverse() {
            try {
                const response = await fetch('https://rickandmortyapi.com/api/location');
                const data = await response.json();
                
                document.getElementById('loading').style.display = 'none';
                
                data.results.forEach(location => {
                    createPlanet(location);
                });

            } catch (error) {
                console.error("Portal Gun Malfunction:", error);
                document.getElementById('loading').innerText = "Err: Portal Fluid Low";
            }
        }

        function createPlanet(data) {
            const size = Math.random() * 2 + 1; 
            const geometry = new THREE.IcosahedronGeometry(size, 1);
            
            const colors = [0x97ce4c, 0x4cb5ce, 0xce4c4c, 0xc4ce4c, 0x8a4cce];
            const color = colors[Math.floor(Math.random() * colors.length)];

            const material = new THREE.MeshStandardMaterial({ 
                color: color, 
                roughness: 0.7,
                metalness: 0.2,
                flatShading: true
            });

            const planet = new THREE.Mesh(geometry, material);

            planet.position.x = (Math.random() - 0.5) * 100;
            planet.position.y = (Math.random() - 0.5) * 60;
            planet.position.z = (Math.random() - 0.5) * 60;

            planet.userData = { 
                name: data.name,
                type: data.type,
                dimension: data.dimension,
                residents: data.residents.length
            };

            scene.add(planet);
            planetMeshes.push(planet);
        }

        fetchUniverse();

        function onMouseClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(planetMeshes);

            if (intersects.length > 0) {
                const target = intersects[0].object;
                showInfo(target.userData);
                
                const originalColor = target.material.color.getHex();
                target.material.color.setHex(0xffffff);
                setTimeout(() => {
                    target.material.color.setHex(originalColor);
                }, 200);
            } else {
                hideInfo();
            }
        }

        function showInfo(data) {
            const modal = document.getElementById('info-modal');
            document.getElementById('loc-name').innerText = data.name;
            document.getElementById('loc-type').innerText = data.type;
            document.getElementById('loc-dim').innerText = data.dimension;
            document.getElementById('loc-residents').innerText = data.residents;
            modal.style.display = 'block';
        }

        function hideInfo() {
            document.getElementById('info-modal').style.display = 'none';
        }

        window.addEventListener('click', onMouseClick);

        function animate() {
            requestAnimationFrame(animate);

            planetMeshes.forEach(planet => {
                planet.rotation.x += 0.002;
                planet.rotation.y += 0.002;
            });

            stars.rotation.y -= 0.0005;

            controls.update();
            renderer.render(scene, camera);
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>

